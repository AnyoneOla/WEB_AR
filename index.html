<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>AR Object Picker | Pro AR Studio</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<style>
		body {
			margin: 0;
			overflow: hidden;
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			background-color: #000;
		}

		/* Branding / Header */
		#header {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			padding: 15px 20px;
			background: rgba(0, 0, 0, 0.6);
			color: white;
			font-size: 20px;
			font-weight: 600;
			z-index: 10;
			box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
			backdrop-filter: blur(10px);
		}

		#object-bar {
			position: fixed;
			bottom: 0;
			left: 0;
			width: 100%;
			display: flex;
			overflow-x: auto;
			padding: 10px;
			background: rgba(0, 0, 0, 0.6);
			gap: 12px;
			justify-content: center;
			align-items: center;
			z-index: 10;
			backdrop-filter: blur(10px);
			padding-bottom: env(safe-area-inset-bottom);
		}

		.object-btn {
			flex: 0 0 auto;
			background: #1e1e1e;
			border: 2px solid transparent;
			border-radius: 10px;
			padding: 6px;
			cursor: pointer;
			transition: all 0.2s ease;
			width: 75px; /* Wider button to accommodate preview */
			height: 90px;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			position: relative;
			color: white;
			font-size: 10px;
			text-align: center;
		}

		.object-btn:hover,
		.object-btn.selected {
			border-color: #00bfff;
			transform: scale(1.05);
			background: #2b2b2b;
		}

		.object-btn .preview-img {
			width: 60px;
			height: 60px;
			background: #333;
			border-radius: 8px;
			object-fit: contain;
			margin-bottom: 5px;
			border: 1px solid #444;
		}
		
		.object-btn .object-name {
			font-size: 10px;
			margin-top: 5px;
			white-space: nowrap;
		}

		#loader {
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			color: white;
			font-size: 18px;
			background: rgba(0,0,0,0.8);
			padding: 20px 30px;
			border-radius: 8px;
			z-index: 20;
			display: none;
		}
	</style>

	<script type="importmap">
		{
			"imports": {
				"three": "https://unpkg.com/three@0.155.0/build/three.module.js",
				"three/addons/": "https://unpkg.com/three@0.155.0/examples/jsm/"
			}
		}
	</script>
</head>
<body>

	<div id="header">Pro AR Studio</div>

	<div id="object-bar">
		<button class="object-btn selected" data-object="cone">
			<img class="preview-img" src="

http://googleusercontent.com/image_collection/image_retrieval/3623831216886132193_0
" alt="Cone" />
			<span class="object-name">Cone</span>
		</button>
		<button class="object-btn" data-object="cube">
			<img class="preview-img" src="

http://googleusercontent.com/image_collection/image_retrieval/15994511292850026381_0
" alt="Cube" />
			<span class="object-name">Cube</span>
		</button>
		<button class="object-btn" data-object="sphere">
			<img class="preview-img" src="https://img.icons8.com/ios-filled/50/sphere.png" alt="Sphere" />
			<span class="object-name">Sphere</span>
		</button>

		<button class="object-btn" data-object="couple-musical-box">
			<img class="preview-img" src="https://img.icons8.com/plasticine/100/3d-printer.png" alt="Musical Box" />
			<span class="object-name">Musical Box</span>
		</button>
		<button class="object-btn" data-object="robot">
			<img class="preview-img" src="http://googleusercontent.com/image_collection/image_retrieval/6196946999967431273_0" alt="Robot" />
			<span class="object-name">Robot</span>
		</button>
	</div>

	<div id="loader">Loading model...</div>

	<script type="module">
		import * as THREE from 'three';
		import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
		import { ARButton } from 'three/addons/webxr/ARButton.js';

		let camera, scene, renderer, controller, raycaster;
		let selectedObject = 'cone';
		let draggedObject = null;
		const loader = new GLTFLoader();

		const objectButtons = document.querySelectorAll('.object-btn');
		const loaderUI = document.getElementById('loader');

		init();

		function init() {
			const container = document.createElement('div');
			document.body.appendChild(container);

			scene = new THREE.Scene();
			camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.01, 20);

			const light = new THREE.HemisphereLight(0xffffff, 0xbbbbff, 2);
			light.position.set(0.5, 1, 0.25);
			scene.add(light);
			
			// Add a directional light for better model shading
			const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
			directionalLight.position.set(1, 1, 1);
			scene.add(directionalLight);

			renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
			renderer.setPixelRatio(window.devicePixelRatio);
			renderer.setSize(window.innerWidth, window.innerHeight);
			renderer.xr.enabled = true;
			renderer.setAnimationLoop(animate);
			container.appendChild(renderer.domElement);

			document.body.appendChild(ARButton.createButton(renderer, { requiredFeatures: ['hit-test'] }));

			raycaster = new THREE.Raycaster();
			
			controller = renderer.xr.getController(0);
			controller.addEventListener('selectstart', onSelectStart);
			controller.addEventListener('selectend', onSelectEnd);
			scene.add(controller);

			window.addEventListener('resize', onWindowResize);

			// Button interaction
			objectButtons.forEach(btn => {
				btn.addEventListener('click', () => {
					objectButtons.forEach(b => b.classList.remove('selected'));
					btn.classList.add('selected');
					selectedObject = btn.dataset.object;
				});
			});
		}

		function createPrimitiveGeometry(type) {
			switch (type) {
				case 'cone':
					return new THREE.CylinderGeometry(0, 0.05, 0.2, 32);
				case 'cube':
					return new THREE.BoxGeometry(0.1, 0.1, 0.1);
				case 'sphere':
					return new THREE.SphereGeometry(0.07, 32, 32);
				default:
					return null;
			}
		}

		function showLoader(show) {
			loaderUI.style.display = show ? 'block' : 'none';
		}

		function onSelectStart() {
			const intersects = raycaster.intersectObjects(scene.children);
			if (intersects.length > 0) {
				const target = intersects[0].object;
				// Find the top-level parent if it's a sub-mesh of a GLTF model
				draggedObject = target;
				while (draggedObject.parent && draggedObject.parent !== scene) {
					draggedObject = draggedObject.parent;
				}
				
				// Remove the object from the scene and add it to the controller
				scene.remove(draggedObject);
				controller.add(draggedObject);
			} else {
				// No object was hit, so create a new one
				const primitive = createPrimitiveGeometry(selectedObject);
				if (primitive) {
					const material = new THREE.MeshPhongMaterial({ color: Math.random() * 0xffffff });
					const mesh = new THREE.Mesh(primitive, material);
					mesh.position.set(0, 0, -0.3); // Relative to the controller
					controller.add(mesh);
					draggedObject = mesh;
					return;
				}

				// Load GLTF model
				let modelUrl = null;
				if (selectedObject === 'couple-musical-box') {
					// This is a free model from Sketchfab
					modelUrl = 'https://cdn.glitch.global/05d6b412-f046-4c46-953e-2b581c3c3996/couple_musical_box.glb?v=1679901416462';
				} else if (selectedObject === 'robot') {
					modelUrl = 'https://modelviewer.dev/shared-assets/models/RobotExpressive.glb';
				}

				if (modelUrl) {
					showLoader(true);
					loader.load(modelUrl, (gltf) => {
						const model = gltf.scene;
						model.scale.set(0.1, 0.1, 0.1); // Adjust scale as needed
						model.position.set(0, 0, -0.3);
						controller.add(model);
						draggedObject = model;
						showLoader(false);
					}, undefined, (error) => {
						console.error('Error loading model:', error);
						showLoader(false);
					});
				}
			}
		}

		function onSelectEnd() {
			if (draggedObject) {
				// Detach the object from the controller and add it back to the scene
				controller.remove(draggedObject);
				scene.add(draggedObject);
				draggedObject = null;
			}
		}

		function onWindowResize() {
			camera.aspect = window.innerWidth / window.innerHeight;
			camera.updateProjectionMatrix();
			renderer.setSize(window.innerWidth, window.innerHeight);
		}

		function animate() {
			if (renderer.xr.isPresenting) {
				// Update raycaster for picking
				raycaster.setFromCamera({ x: 0, y: 0 }, camera);
			}
			renderer.render(scene, camera);
		}
	</script>

</body>
</html>
